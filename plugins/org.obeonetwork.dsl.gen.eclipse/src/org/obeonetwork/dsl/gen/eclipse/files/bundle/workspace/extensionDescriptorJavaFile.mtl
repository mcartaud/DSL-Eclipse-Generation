[comment encoding = UTF-8 

Copyright (c) 2012 Obeo
All rights reserved.  This program and the accompanying materials
are made available under the terms of the Eclipse Public License 1.0
which accompanies this distribution, and is available at
http://www.eclipse.org/legal/epl-v10.html

You can apply any license to the files generated with this module and Acceleo.

Contributors :
	Mathieu Cartaud (Obeo) - initial API and implementation
/]
[module extensionDescriptorJavaFile('http://www.obeonetwork.org/dsl/eclipse')]

[import org::obeonetwork::dsl::gen::eclipse::common::normalizeName /]


[template private extensionDescriptorJavaFile(anExtensionPoint : ExtensionPointProvider)]
[anExtensionPoint.eContainer(Bundle).genBundleJavaPath()/]/registry/[anExtensionPoint.genExtensionName().toLowerFirst()/]/[anExtensionPoint.genExtensionName()/]ExtensionDescriptor.java
[/template]

[template public genExtensionDescriptorJavaFile(anExtensionPoint : ExtensionPointProvider)]
[file (extensionDescriptorJavaFile(), false, 'UTF-8')]
package [anExtensionPoint.ancestors(Bundle).genBundleID()/].registry.[anExtensionPoint.genExtensionName().toLowerFirst()/];

import org.eclipse.core.runtime.CoreException;
import org.eclipse.core.runtime.IConfigurationElement;

/**
 * Describes a extension as contributed to the "[anExtensionPoint.ancestors(Bundle).genBundleID()/].[anExtensionPoint.genExtensionName()/]Extension" extension point.
 * 
 */
public class [anExtensionPoint.genExtensionName()/]ExtensionDescriptor {

	/** Name of the [anExtensionPoint.name/] extension point's tag "[anExtensionPoint.className/]" attribute. */
	public static final String [anExtensionPoint.staticExtensionName()/]_ATTRIBUTE_[anExtensionPoint.className.toUpper().substituteAll(' ', '_')/] = "[anExtensionPoint.className/]"; //$NON-NLS-1$
[for (anAttribute : Attribute | anExtensionPoint.attributes)]

	/** Name of the [anExtensionPoint.name/] extension point's tag "[anAttribute.nonQualifiedName/]" attribute. */
	public static final String [anExtensionPoint.staticExtensionName()/]_ATTRIBUTE_[anAttribute.nonQualifiedName.toUpper().substituteAll(' ', '_')/] = "[anAttribute.nonQualifiedName/]"; //$NON-NLS-1$
[/for]

	/** Configuration element of this descriptor. */
	private final IConfigurationElement element;

	/** Qualified [anExtensionPoint.className/] name of the [anExtensionPoint.name/] extension. This will be used as an id to remove contributions. */
	private final String extension[anExtensionPoint.className.toUpperFirst()/];

[for (anAttribute : Attribute | anExtensionPoint.attributes)]

	/** Qualified [anAttribute.nonQualifiedName/] name of the [anExtensionPoint.name/] extension. */
	private final String extension[anAttribute.nonQualifiedName.toUpperFirst()/];

[if (anAttribute.type.toString().matches('java'))]
	/** We only need to create the instance once, this will keep reference to it. */
	private I[anAttribute.genAttributeClassName()/]Extension [anAttribute.genAttributeClassName().toLowerFirst()/]Extension;

[/if]
[/for]
	/** We only need to create the instance once, this will keep reference to it. */
	private I[anExtensionPoint.refactorExtensionClassName()/]Extension [anExtensionPoint.refactorExtensionClassName().toLowerFirst()/]Extension;


	/**
	 * Instantiates a descriptor with all information.
	 * 
	 * @param configuration
	 *            Configuration element from which to create this descriptor.
	 */
	public [anExtensionPoint.genExtensionName()/]ExtensionDescriptor(IConfigurationElement configuration) {
		element = configuration;
		extension[anExtensionPoint.className.toUpperFirst()/] = configuration.getAttribute([anExtensionPoint.staticExtensionName()/]_ATTRIBUTE_[anExtensionPoint.className.toUpper()/]);
[for (anAttribute : Attribute | anExtensionPoint.attributes)]
		extension[anAttribute.nonQualifiedName.toUpperFirst()/] = configuration.getAttribute([anExtensionPoint.staticExtensionName()/]_ATTRIBUTE_[anAttribute.nonQualifiedName.toUpper()/]);
[/for]
	}

	/**
	 * Returns this descriptor's "[anExtensionPoint.className/]" class name.
	 * 
	 * @return This descriptor's "[anExtensionPoint.className/]" class name.
	 */
	public String getExtension[anExtensionPoint.className.toUpperFirst()/]() {
		return extension[anExtensionPoint.className.toUpperFirst()/];
	}

[for (anAttribute : Attribute | anExtensionPoint.attributes)]
	/**
	 * Returns this descriptor's "[anAttribute.nonQualifiedName/]" class name.
	 * 
	 * @return This descriptor's "[anAttribute.nonQualifiedName/]" class name.
	 */
	public String getExtension[anAttribute.nonQualifiedName.toUpperFirst()/]() {
		return extension[anAttribute.nonQualifiedName.toUpperFirst()/];
	}
[/for]

	/**
	 * Creates an instance of this descriptor's {@link I[anExtensionPoint.refactorExtensionClassName()/]Extension}.
	 * 
	 * @return A new instance of this descriptor's {@link I[anExtensionPoint.refactorExtensionClassName()/]Extension}.
	 */
	public I[anExtensionPoint.refactorExtensionClassName()/]Extension get[anExtensionPoint.refactorExtensionClassName()/]Extension() {
		if ([anExtensionPoint.refactorExtensionClassName().toLowerFirst()/]Extension == null) {
			try {
				[anExtensionPoint.refactorExtensionClassName().toLowerFirst()/]Extension = (I[anExtensionPoint.refactorExtensionClassName()/]Extension)element
						.createExecutableExtension([anExtensionPoint.staticExtensionName()/]_ATTRIBUTE_[anExtensionPoint.className.toUpper().substituteAll(' ', '_')/]);
			} catch (CoreException e) {
				e.printStackTrace();
			}
		}
		return [anExtensionPoint.refactorExtensionClassName().toLowerFirst()/]Extension;
	}

[for (anAttribute : Attribute | anExtensionPoint.attributes)]
[if (anAttribute.type.toString().matches('java'))]
	/**
	 * Creates an instance of this descriptor's {@link I[anAttribute.genAttributeClassName()/]Extension}.
	 * 
	 * @return A new instance of this descriptor's {@link I[anAttribute.genAttributeClassName()/]Extension}.
	 */
	public I[anAttribute.genAttributeClassName()/]Extension get[anAttribute.genAttributeClassName()/]Extension() {
		if ([anAttribute.genAttributeClassName().toLowerFirst()/]Extension == null) {
			try {
				[anAttribute.genAttributeClassName().toLowerFirst()/]Extension = (I[anAttribute.genAttributeClassName()/]Extension)element
						.createExecutableExtension([anExtensionPoint.staticExtensionName()/]_ATTRIBUTE_[anAttribute.nonQualifiedName.toUpper().substituteAll(' ', '_')/]);
			} catch (CoreException e) {
				e.printStackTrace();
			}
		}
		return [anAttribute.genAttributeClassName().toLowerFirst()/]Extension;
	}
[/if]
[/for]

}
[/file]
[/template]
